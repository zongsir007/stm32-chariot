##### 1\. 配置层：main.c (或 can.c) 中的过滤器设置

这是最关键的入口。STM32 的 CAN 硬件默认是“全关”的，只有在这里配置了规则，数据才能进入单片机。



###### 调试位置：CAN\_Filter\_Config() 函数。



调试重点：



掩码（Mask）逻辑：如果你想接收 0x201~0x204，通常有两种设法：



全通模式：FilterId 和 FilterMaskId 全部设为 0x0000。这会让所有 ID 都能通过，适合调试初期排查硬件问题。



精确模式：设置 FilterIdHigh 为 0x200 << 5，并将掩码设为只检查特定位。



过滤器组 (Bank)：确保 FilterBank 选的是 0。

##### 

##### 2\. 接收层：motor\_driver.c 中的回调函数

这里是数据被硬件接收后，进入软件处理的第一站。



###### 调试位置：HAL\_CAN\_RxFifo0MsgPendingCallback(CAN\_HandleTypeDef \*hcan)。



调试方法（断点调试）：



在函数入口处打一个断点。



观察程序是否停在断点：



停不下来：说明硬件过滤器（上面的第1点）配置错误，或者 CAN 总线物理链路没通（线接反了、没加电阻、波特率不对）。



能停下来：说明通讯通了。此时检查 rx\_header.StdId 的值，看它是不是你预期的 0x201、0x202 等。



##### 3\. 定义层：motor\_driver.h 与 config.h 中的 ID 定义

这里决定了你的程序“认不认识”这些 ID。



###### 调试位置：宏定义区域。



调试内容：



检查电调发送 ID 是否为 0x200（控制 1-4 号电调）。



检查接收 ID 起始偏移是否正确（大疆电调默认起始是 0x201）。



物理匹配：核对电调上的 LED 灯闪烁次数，或者拨码开关设置。如果你电调物理 ID 是 5，但代码只收 0x201~0x204，那永远收不到数据。



